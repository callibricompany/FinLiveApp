
var mappingFreshApp = [
  {
    "code": "",
    "app": "date",
    "typeInApp": "D",
    "freshdesk": "cf_date_de_strike",
    "typeInFreshdesk": "D"
  },
  {
    "code": "",
    "app": "startdate",
    "typeInApp": "D",
    "freshdesk": "cf_ps_startdate",
    "typeInFreshdesk": "D"
  },
  {
    "code": "",
    "app": "finaldate",
    "typeInApp": "D",
    "freshdesk": "cf_ps_finaldate",
    "typeInFreshdesk": "D"
  },
  {
    "code": "",
    "app": "enddate",
    "typeInApp": "D",
    "freshdesk": "cf_ps_enddate",
    "typeInFreshdesk": "D"
  },
  {
    "code": "U",
    "app": "underlying",
    "typeInApp": "T",
    "freshdesk": "cf_ps_underlying",
    "typeInFreshdesk": "T"
  },
  {
    "code": "M",
    "app": "maturity",
    "typeInApp": "T",
    "freshdesk": "cf_maturit",
    "typeInFreshdesk": "T"
  },
  {
    "code": "CU",
    "app": "currency",
    "typeInApp": "T",
    "freshdesk": "cf_devise",
    "typeInFreshdesk": "T"
  },
  {
    "code": "LA",
    "app": "levelAutocall",
    "typeInApp": "N",
    "freshdesk": "cf_levelautocall",
    "typeInFreshdesk": "N%"
  },
  {
    "code": "CA",
    "app": "couponAutocall",
    "typeInApp": "N",
    "freshdesk": "cf_couponautocall",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "II",
    "app": "isIncremental",
    "typeInApp": "B",
    "freshdesk": "cf_isincremental",
    "typeInFreshdesk": "B"
  },
  {
    "code": "FA",
    "app": "freqAutocall",
    "typeInApp": "T",
    "freshdesk": "cf_freq_rappel",
    "typeInFreshdesk": "T"
  },
  {
    "code": "DS",
    "app": "degressiveStep",
    "typeInApp": "N",
    "freshdesk": "cf_degressivestep",
    "typeInFreshdesk": "N%"
  },
  {
    "code": "NNCP",
    "app": "noCallNbPeriod",
    "typeInApp": "N",
    "freshdesk": "cf_nombre_de_priode_sans_rappel",
    "typeInFreshdesk": "N"
  },
  {
    "code": "C",
    "app": "coupon",
    "typeInApp": "N",
    "freshdesk": "cf_coupon",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "AL",
    "app": "typeAirbag",
    "typeInApp": "N",
    "freshdesk": "cf_airbaglevel",
    "typeInFreshdesk": "N%"
  },
  {
    "code": "BPDI",
    "app": "barrierPDI",
    "typeInApp": "N",
    "freshdesk": "cf_barrierpdi",
    "typeInFreshdesk": "N%"
  },
  {
    "code": "PDIUS",
    "app": "isPDIUS",
    "typeInApp": "B",
    "freshdesk": "cf_ispdius",
    "typeInFreshdesk": "B"
  },
  {
    "code": "CP",
    "app": "couponPhoenix",
    "typeInApp": "N",
    "freshdesk": "cf_couponphoenix",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "FP",
    "app": "freqPhoenix",
    "typeInApp": "T",
    "freshdesk": "cf_frquence_coupon",
    "typeInFreshdesk": "T"
  },
  {
    "code": "CB",
    "app": "barrierPhoenix",
    "typeInApp": "N",
    "freshdesk": "cf_barrierphoenix",
    "typeInFreshdesk": "N%"
  },
  {
    "code": "IM",
    "app": "isMemory",
    "typeInApp": "B",
    "freshdesk": "cf_mmoire",
    "typeInFreshdesk": "B"
  },
  {
    "code": "",
    "app": "vega",
    "typeInApp": "N",
    "freshdesk": "cf_ps_vegasim",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_identifiant_produit",
    "typeInApp": "N",
    "freshdesk": "cf_identifiant_produit",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_broad_begindate",
    "typeInApp": "D",
    "freshdesk": "cf_broad_begindate",
    "typeInFreshdesk": "D"
  },
  {
    "code": "",
    "app": "cf_broad_enddate",
    "typeInApp": "D",
    "freshdesk": "cf_broad_enddate",
    "typeInFreshdesk": "D"
  },
  {
    "code": "",
    "app": "cf_broad_amount",
    "typeInApp": "N",
    "freshdesk": "cf_broad_amount",
    "typeInFreshdesk": "N"
  },
  {
    "code": "",
    "app": "cf_cpg_productaccepted",
    "typeInApp": "B",
    "freshdesk": "cf_cpg_productaccepted",
    "typeInFreshdesk": "B"
  },
  {
    "code": "",
    "app": "isairbag",
    "typeInApp": "B",
    "freshdesk": "cf_isairbag",
    "typeInFreshdesk": "B"
  },
  {
    "code": "",
    "app": "cf_cpg_emailconfirmation",
    "typeInApp": "T",
    "freshdesk": "cf_cpg_emailconfirmation",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_cpg_amfapproval",
    "typeInApp": "B",
    "freshdesk": "cf_cpg_amfapproval",
    "typeInFreshdesk": "B"
  },
  {
    "code": "",
    "app": "cf_cpg_begindate",
    "typeInApp": "D",
    "freshdesk": "cf_cpg_begindate",
    "typeInFreshdesk": "D"
  },
  {
    "code": "",
    "app": "cf_cpg_choice",
    "typeInApp": "T",
    "freshdesk": "cf_cpg_choice",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_cpg_confirmationemail",
    "typeInApp": "T",
    "freshdesk": "cf_cpg_confirmationemail",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_cpg_custodiandelivery",
    "typeInApp": "B",
    "freshdesk": "cf_cpg_custodiandelivery",
    "typeInFreshdesk": "B"
  },
  {
    "code": "",
    "app": "broker1name",
    "typeInApp": "T",
    "freshdesk": "cf_broker1name",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "broker2name",
    "typeInApp": "T",
    "freshdesk": "cf_broker2name",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "broker3name",
    "typeInApp": "T",
    "freshdesk": "cf_broker3name",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "brokernamewinner",
    "typeInApp": "T",
    "freshdesk": "cf_brokernamewinner",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "couponautocall1",
    "typeInApp": "N",
    "freshdesk": "cf_couponautocall1",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "couponautocall2",
    "typeInApp": "N",
    "freshdesk": "cf_couponautocall2",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "couponautocall3",
    "typeInApp": "N",
    "freshdesk": "cf_couponautocall3",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "couponAutocallExecuted",
    "typeInApp": "N",
    "freshdesk": "cf_couponAutocallExecuted",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "couponphoenix1",
    "typeInApp": "N",
    "freshdesk": "cf_couponphoenix1",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "couponphoenix2",
    "typeInApp": "N",
    "freshdesk": "cf_couponphoenix2",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "couponphoenix3",
    "typeInApp": "N",
    "freshdesk": "cf_couponphoenix3",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "couponPhoenixExecuted",
    "typeInApp": "N",
    "freshdesk": "cf_couponPhoenixExecuted",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "UFAsso",
    "typeInApp": "N",
    "freshdesk": "cf_rtro_asso",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "UF",
    "typeInApp": "N",
    "freshdesk": "cf_rtro",
    "typeInFreshdesk": "T.2d%"
  },
  {
    "code": "",
    "app": "cf_cpg_enddate",
    "typeInApp": "D",
    "freshdesk": "cf_cpg_enddate",
    "typeInFreshdesk": "D"
  },
  {
    "code": "",
    "app": "cf_cpg_exclusive",
    "typeInApp": "B",
    "freshdesk": "cf_cpg_exclusive",
    "typeInFreshdesk": "B"
  },
  {
    "code": "",
    "app": "cf_cpg_insurerapproval",
    "typeInApp": "B",
    "freshdesk": "cf_cpg_insurerapproval",
    "typeInFreshdesk": "B"
  },
  {
    "code": "",
    "app": "cf_cpg_productaccepted",
    "typeInApp": "B",
    "freshdesk": "cf_cpg_productaccepted",
    "typeInFreshdesk": "B"
  },
  {
    "code": "",
    "app": "nominal",
    "typeInApp": "N",
    "freshdesk": "cf_ps_nominal",
    "typeInFreshdesk": "N"
  },
  {
    "code": "",
    "app": "cf_message",
    "typeInApp": "T",
    "freshdesk": "cf_message",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_je_veux_une_cotation_sur",
    "typeInApp": "T",
    "freshdesk": "cf_je_veux_une_cotation_sur",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_notes_prives",
    "typeInApp": "T",
    "freshdesk": "cf_notes_prives",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "description",
    "typeInApp": "T",
    "freshdesk": "description",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "status",
    "typeInApp": "N",
    "freshdesk": "status",
    "typeInFreshdesk": "N"
  },
  {
    "code": "",
    "app": "priority",
    "typeInApp": "N",
    "freshdesk": "priority",
    "typeInFreshdesk": "N"
  },
  {
    "code": "",
    "app": "cf_soustype",
    "typeInApp": "T",
    "freshdesk": "cf_soustype",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_statusproduct",
    "typeInApp": "T",
    "freshdesk": "cf_statusproduct",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_step_ape",
    "typeInApp": "T",
    "freshdesk": "cf_step_ape",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_step_pp",
    "typeInApp": "T",
    "freshdesk": "cf_step_pp",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "cf_surface",
    "typeInApp": "N",
    "freshdesk": "cf_surface",
    "typeInFreshdesk": "N"
  },
  {
    "code": "",
    "app": "cf_type",
    "typeInApp": "N",
    "freshdesk": "cf_type",
    "typeInFreshdesk": "N"
  },
  {
    "code": "",
    "app": "subject",
    "typeInApp": "T",
    "freshdesk": "subject",
    "typeInFreshdesk": "T"
  },
  {
    "code": "",
    "app": "department",
    "typeInApp": "T",
    "freshdesk": "department",
    "typeInFreshdesk": "T"
  }
 ]

export function convertFresh( object ) {
    
    var arrayOfKeysObject = Object.keys(object);
    var nKeysObject = arrayOfKeysObject.length;
    var convertObject = {};
    
    for (var i = 0; i < nKeysObject; i++ ) {
     if ( object[arrayOfKeysObject[i]] != null ) {
        var result = mappingFreshApp.find(obj => { return obj.freshdesk === arrayOfKeysObject[i] });
        if (typeof result != 'undefined') {
        convertObject[result.app] = formatApp(object[arrayOfKeysObject[i]], result.typeInApp, result.typeInFreshdesk);
        }
     }
    }
    
    return convertObject;
    
}

function formatApp( val, format, oldformat) {
    
    var converted;
    var valStr;
    var valFloat;
    
    // console.log(val);
    // console.log(format);
    
    switch (format) {
    case "D":
        valStr = val.toString();
        var year = valStr.substring(0, 4);
        var month = valStr.substring(5, 7);
        var day = valStr.substring(8, 10);
        converted = Number(year + month  +  day);
        break;
    case "T":
        converted = val.toString();
        break;
    case "B":
        converted = val; // ( val == 'true');
        break;
    case "N":
        switch (oldformat) {
        case "N":
        converted = Number(val);
        break;
        case "T":
        converted = Number(val);
        break;
        case "T.2d":
        converted = Number(val);
        break;
        case "N%":
        valFloat = val/100;
        converted = Number(valFloat.toFixed(2));
        break;
        case "T.2d%":
        valFloat = Number(val)/100;
        converted = Number(valFloat.toFixed(4));
        break;
        }
    }
    
    return converted;

}


//module.exports = convertCharacFreshToApp;

// var obj = {
//       cf_rponse_metteur_2_en: '4.22',
//       cf_rtro: '3.54',
//       cf_ps_nominal: 100000000,
//       cf_coupon: '4.23',
//       cf_freq_rappel: '6M',
//       cf_ps_priceexec: '3.23',
//       cf_ps_underlying: 'SX5E',
//       cf_nom_emetteur_3: 'C',
//       cf_isairbag: true,
//       cf_ps_finaldate: '2023-09-20',
//       cf_nom_emetteur_1: 'A',
//       cf_isincremental: true,
//       cf_rponse_metteur_3_en: '3.12',
//       cf_rponse_metteur_4_en: '3.11',
//       cf_ps_vegasim: '5.33',
//       cf_ps_brokerexecname: 'E',
//       cf_nom_emetteur_2: 'B',
//       cf_cpg_exclusive: false,
//       cf_ps_pricesimul: '3.44',
//       cf_cpg_choice: "Appel public à l'épargne",
//       cf_cpg_begindate: '2019-09-11',
//       cf_devise: 'EUR',
//       cf_coupon_phoenix: '45.0',
//       cf_rponse_metteur_1: '3.23',
//       cf_step_ape: 'Définition des besoins (APEDVB)',
//       cf_nom_metteur_4: 'D',
//       cf_degressivestep: 45,
//       cf_ps_enddate: '2023-11-16',
//       cf_maturit: '4Y',
//       cf_je_veux_une_cotation_sur: 'la rétrocession',
//       cf_levelautocall: 56,
//       cf_ispdius: true,
//       cf_couponautocall: '3.44',
//       cf_nombre_de_priode_sans_rappel: 10,
//       cf_mmoire: true,
//       cf_date_de_strike: '2019-10-17',
//       cf_airbaglevel: 75,
//       cf_barrierphoenix: 34,
//       cf_ps_startdate: '2019-09-25',
//       cf_barrierpdi: 34,
//       cf_frquence_coupon: '6M',
//     };

// console.log(convertCharacFreshToApp(obj));